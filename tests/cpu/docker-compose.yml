version: "3.9"

services:
  asr_ocr:
    image: ghcr.io/knowusuboaky/asr_ocr:latest
    container_name: asr_ocr
    restart: unless-stopped
    ports:
      - "9002:9002"
    # platform: linux/amd64   # uncomment to pin arch on Apple Silicon, etc.

    # environment:
    #   # --- Server/runtime ---
    #   UVICORN_WORKERS: "1"
    #
    #   # --- ASR ---
    #   ASR_MODEL: "large-v3"
    #   VAD_MIN_SIL_MS: "500"
    #   KEEP_WAV: "false"
    #   KEEP_WAV_ON_ERROR: "true"
    #
    #   # --- OCR/VLM ---
    #   OCR_LANGS: "en"
    #   OCR_UPSCALE: "1.5"
    #   FLORENCE_MAX_CONCURRENCY: "1"
    #
    #   # --- Snapshot/cache behavior (single knobs; baked snapshots preferred) ---
    #   FLORENCE_ALLOW_DOWNLOAD: "false"
    #   WHISPER_ALLOW_DOWNLOAD: "false"
    #
    #   # --- Optional overrides (defaults already point to baked paths) ---
    #   FLORENCE_LOCAL_DIR: "/models/hf/Florence-2-large"
    #   WHISPER_SNAPSHOT_DIR: "/models/hf/faster-whisper-large-v3"
    #
    # volumes:
    #   # WARNING: Mounting here will OVERRIDE baked snapshots inside the image.
    #   # Use only if you want to manage/cache models on the host.
    #   - ./models:/models/hf
    #   # Or use a separate cache dir instead of your repo models:
    #   # - ./models_cache:/models/hf

    healthcheck:
      test: ["CMD", "curl", "-fsS", "http://127.0.0.1:9002/health"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 30s
